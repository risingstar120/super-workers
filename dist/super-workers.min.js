/*!
 * 
 * super-workers "0.1.0"
 * https://github.com/softvar/super-workers.js
 * MIT LICENSE
 * 
 * Copyright (C) 2017-2018 softvar - A project by Varun Malhotra(https://github.com/softvar)
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SuperWorkers",[],t):"object"==typeof exports?exports.SuperWorkers=t():e.SuperWorkers=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=n(o),i=r(2),s=n(i),u=r(13),d=n(u),l={MainThread:s["default"],WorkerThread:d["default"],Promise:a["default"]};t["default"]=l,e.exports=t["default"]},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){function n(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function o(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}function a(e,t,r){return function(n){try{var o=e(n);o&&"function"==typeof o.then&&"function"==typeof o["catch"]?o.then(t,r):t(o)}catch(a){r(a)}}}r(this,e);var i=this,s=void 0,u=void 0,d=void 0;if(n.prototype=new Error,n.prototype.constructor=Error,n.prototype.name="CancellationError",o.prototype=new Error,o.prototype.constructor=Error,o.prototype.name="TimeoutError",this.CancellationError=n,this.TimeoutError=o,this["catch"]=function(e){return this.then(null,e)},!(this instanceof e))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof t)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var l=[],f=[];d=function(e,t){l.push(e),f.push(t)},this.then=function(t,r){return new e(function(e,n){var o=t?a(t,e,n):e,i=r?a(r,e,n):n;d(o,i)},i)},s=function(e){return l.forEach(function(t){t(e)}),d=function(t,r){t(e)},s=u=function(){throw new Error("Promise is already resolved")},i},u=function(e){return f.forEach(function(t){t(e)}),d=function(t,r){r(e)},s=u=function(){throw new Error("Promise is already resolved")},i},this.cancel=function(){return u(new n),i},this.timeout=function(e){var t=setTimeout(function(){u(new o("Promise timed out after "+e+" ms"))},e);return i.always(function(){clearTimeout(t)}),i},t(function(e){s(e)},function(e){u(e)})}return n(e,[{key:"always",value:function(e){return this.then(e,e)}}],[{key:"all",value:function(t){return new e(function(e,r){var n=t.length,o=[];n?t.forEach(function(t,a){t.then(function(t){o[a]=t,n--,0===n&&e(o)},function(e){n=0,r(e)})}):e(o)})}},{key:"defer",value:function(){var t={};return t.promise=new e(function(e,r){t.resolve=e,t.reject=r}),t}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(3),u=n(s),d=r(1),l=n(d),f=r(5),c=n(f),h=r(8),p=n(h),v=r(12),g=n(v),m=r(7),k=n(m),y=r(11),E=n(y),_=r(10),w=n(_),b=function(){function e(t){o(this,e),t=t||{},"undefined"==typeof t.maxWorkers&&(t.minWorkers=1),"undefined"==typeof t.maxWorkers&&(t.maxWorkers=window.navigator&&window.navigator.hardwareConcurrency||3),t.maxWorkers=Math.max(t.maxWorkers,t.minWorkers),this.workers=p["default"].workers=[],a(this,t),this.config=t,p["default"].config=t,this.init()}return i(e,[{key:"getAllWorkers",value:function(){return p["default"].getAll()}},{key:"getActiveWorkers",value:function(){return p["default"].getActive()}},{key:"getIdleWorkers",value:function(){return p["default"].getIdle()}},{key:"getTerminatedWorkers",value:function(){return p["default"].getTerminated()}},{key:"terminateAllWorkers",value:function(){return p["default"].terminateAll()}},{key:"terminateWorker",value:function(e){return p["default"].terminate(e)}},{key:"broadCastAll",value:function(e){return p["default"].broadCastAll(e)}},{key:"broadCastTo",value:function(e,t){return p["default"].broadCastTo(e,t)}},{key:"exec",value:function(e,t,r){if(t&&!Array.isArray(t))throw new TypeError('Array expected as argument "params"');r||(r={});var n=l["default"].defer(),o={};return a(o,r),a(o,{method:e,params:t,resolver:n,priority:r&&r.priority||k["default"].LOW}),this.taskQueue._add(o),this._runQueuedTask(),n.promise}},{key:"_runQueuedTask",value:function(){var e=this;this.taskQueue.tasks.length||setTimeout(function(){p["default"].terminateAllExceptOne(e.config.minWorkers)},1e3);var t=this.taskQueue.getNextTask(),r=p["default"].getIdle()[0];!r&&p["default"].getActive().length+p["default"].getIdle().length<this.config.maxWorkers&&(this.register(),r=p["default"].getIdle()[0]),r&&(t.runningOnWorkerId=r.id,this.taskQueue._remove(t.id),t.status===k["default"].QUEUED&&(r.status=E["default"].ACTIVE,r.worker.sendMessage(r.worker,{id:r.id,resolver:t.resolver,taskId:t.id,method:t.method,params:t.params,action:g["default"].EXEC}).then(function(t){r.status=E["default"].IDLE,t&&e._runQueuedTask()})["catch"](function(t){r.status===E["default"].TERMINATED&&(p["default"].terminate(r.id),e.config.minWorkers&&e._ensureMinWorkers()),e._runQueuedTask()})))}},{key:"_ensureMinWorkers",value:function(){for(var e=this.workers.length;e<this.config.minWorkers;e++)this.register()}},{key:"register",value:function(){var e=this.config;if(!e)throw new Error(w["default"].CONFIG_REQUIRED);var t=e.url;if(!t)throw new Error(w["default"].URL_REQUIRED);var r=new u["default"](e);return r}},{key:"init",value:function(){return p["default"]._isWebWorkerSupported()?(this.taskQueue=c["default"],void(this.taskQueue.tasks=[])):void console.warn(w["default"].WORKER_NOT_SUPPORTED)}}]),e}();t["default"]=b,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(4),u=n(s),d=r(5),l=n(d),f=r(8),c=n(f),h=r(9),p=n(h),v=r(11),g=n(v),m=r(12),k=n(m),y=function(){function e(t){o(this,e),this.init(t)}return i(e,[{key:"onError",value:function(e){var t=this;this.status=g["default"].TERMINATED;var r=l["default"].getActive(),n=[];r&&r.length&&(n=r.filter(function(e){return e.runningOnWorkerId===t.id}));for(var o=0;o<n.length;o++)n[o].resolver.reject(e);return n}},{key:"addEventListeners",value:function(){var e=this;this.worker.addEventListener("message",this.onWorkerMessage.bind(this),!1),this.worker.addEventListener("error",this.onError.bind(this)),this.worker.addEventListener("exit",function(){var t=new Error("Worker terminated unexpectedly");e.onError(t).bind(e)})}},{key:"onWorkerMessage",value:function(e){if(!e||!e.data||e.data.action!==k["default"].EXEC)return!1;var t=l["default"]._getCompleted(e.data.taskId);return e.data.error?(t.resolver.reject(p["default"].deSerializeError(e.data.error)),this.totalJobsFailed+=1,this.lastJobFaileddAt=+new Date,t.onError&&"function"==typeof t.onError&&t.onError(),!1):(t.resolver.resolve(e.data.result),this.totalJobsCompleted+=1,this.lastJobCompletedAt=+new Date,t.onSuccess&&"function"==typeof t.onSuccess&&t.onSuccess(),!0)}},{key:"init",value:function(e){return e=e||{},a(this,e),this.id=u["default"].generate()||c["default"].workers.length+1,this.status=g["default"].IDLE,this.createdAt=+new Date,this.lastJobCompletedAt=null,this.totalJobsCompleted=0,this.totalJobsFailed=0,this.worker=new Worker(e.url),c["default"].sendMessage(this.worker,{id:this.id,action:k["default"].READY,message:"Worker is ready."}),a(this.worker,{sendMessage:c["default"].sendMessage}),this.addEventListeners(),c["default"].addNew(this),this}}]),e}();t["default"]=y,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});/**
	 * UUID.js: The RFC-compliant UUID generator for JavaScript.
	 * ES6 port of only `generate` method of UUID by Varun Malhotra under MIT License
	 *
	 * @author  LiosK
	 * @version v3.3.0
	 * @license The MIT License: Copyright (c) 2010-2016 LiosK.
	 */
var r=void 0;r=function(){function e(){}return e.generate=function(){var t=e._getRandomInt,r=e._hexAligner;return r(t(32),8)+"-"+r(t(16),4)+"-"+r(16384|t(12),4)+"-"+r(32768|t(14),4)+"-"+r(t(48),12)},e._getRandomInt=function(e){return e<0?NaN:e<=30?0|Math.random()*(1<<e):e<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30):NaN},e._getIntAligner=function(e){return function(t,r){for(var n=t.toString(e),o=r-n.length,a="0";o>0;o>>>=1,a+=a)1&o&&(n=a+n);return n}},e._hexAligner=e._getIntAligner(16),e.prototype.toString=function(){return this.hexString},e}(r),t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),a=n(o),i=r(6),s=n(i),u=r(7),d=n(u),l={config:{},tasks:[],completedTasks:[],_add:function(e){if(!e)throw new Error("No task passed for queuing");if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("Task should be an object");e.id=a["default"].generate()||l.tasks.length,e.status=d["default"].QUEUED,l.tasks.push(e)},_addToCompletedList:function(e){if(!e)throw new Error("No task passed for queuing");if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("Task should be an object");l.completedTasks.push(e)},_remove:function(e){if(!e)throw new Error("No id passed");var t=void 0;t=s["default"].searchByKeyName(l.tasks,"id",e,"both"),l._addToCompletedList(t.obj),t.index!==-1&&l.tasks.splice(t.index,1)},_getCompleted:function(e){if(!e)throw new Error("No id passed");var t=s["default"].searchByKeyName(l.completedTasks,"id",e);return t||{}},get:function(e){if(!e)return l.tasks[0]||{};var t=s["default"].searchByKeyName(l.tasks,"id",e);return t||{}},getNextTask:function(){return s["default"].sortOnStringType(l.tasks,"priority"),l.get()},getActive:function(){return l.tasks.filter(function(e){return e.status===d["default"].ACTIVE})},getCompleted:function(){return l.tasks.filter(function(e){return e.status===d["default"].COMPLETED})},getFailed:function(){return l.tasks.filter(function(e){return e.status===d["default"].FAILED})},getAll:function(){return l.tasks}};t["default"]=l,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={},n={INDEX:"index",OBJECT:"object",BOTH:"both"};r.searchByKeyName=function(e,t,r,o){if(!e||!t)return!1;o=o||n[1];var a=void 0,i=void 0,s=void 0,u=-1;for(a=0;a<e.length;a++){if(i=e[a],!isNaN(r)&&i&&parseInt(i[t],10)===parseInt(r,10)){u=a;break}if(isNaN(r)&&i&&i[t]===r){u=a;break}}switch(u===-1&&(e[u]={}),o){case n.INDEX:s=u;break;case n.BOTH:s={obj:e[u],index:u};break;case n.OBJECT:default:s=e[u]}return s},r.sortOn=function(e,t,r){e.sort(function(e,n){return r?n[t]-e[t]:e[t]-n[t]})},r.sortOnStringType=function(e,t){e.sort(function(e,r){return e[t]<r[t]?-1:e[t]>r[t]?1:0})},t["default"]=r,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={QUEUED:"queued",ACTIVE:"active",FAILED:"failed",COMPLETED:"completed"};t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=r(1),i=n(a),s=r(6),u=n(s),d=r(9),l=n(d),f=r(11),c=n(f),h=r(10),p=n(h),v={workers:[],config:{},_isWebWorkerSupported:function(){return"function"==typeof window.Worker||"object"===o(window.Worker)||"function"==typeof Worker.prototype.constructor},_remove:function(e){var t=void 0;t=u["default"].searchByKeyName(v.workers,"id",e.id,"index"),v.workers.splice(t,1)},addNew:function(e){v.workers.push(e)},getActive:function(){return v.workers.filter(function(e){return e.status===c["default"].ACTIVE})},getIdle:function(){return v.workers.filter(function(e){return e.status===c["default"].IDLE})},getTerminated:function(){return v.workers.filter(function(e){return e.status===c["default"].TERMINATED})},getAll:function(){return v.workers},terminate:function(e){if(!e)return console.warn(p["default"].NO_ID_PROVIDED),v;var t=u["default"].searchByKeyName(v.workers,"id",e,"object");return t&&t.worker&&t.status===c["default"].TERMINATED?(console.warn(p["default"].WORKER_ALREADY_TERMINATED),v):(t&&t.worker&&t.worker.terminate&&(t.worker.terminate(),t.status=c["default"].TERMINATED),v)},terminateAllExceptOne:function(e){return v.terminateAll(!0,e||1)},terminateAll:function(e,t){var r=void 0,n=void 0;for(n=e?[].concat(v.getIdle()):[].concat(v.getActive()).concat(v.getIdle()),r=0;r<n.length;r++){if(e&&v.getIdle()&&v.getIdle().length<=t)return v;n[r]&&n[r].worker&&n[r].worker.terminate&&(n[r].worker.terminate(),n[r].status=c["default"].TERMINATED)}return v},broadCastAll:function(e){var t=void 0,r=v.getActive()||[];for(t=0;t<r.length;t++)v.sendMessage(r[t],e);return v},broadCastTo:function(e,t){var r=void 0,n=[].concat(v.getActive()).concat(v.getIdle());return r=u["default"].searchByKeyName(n,"id",e),r&&v.sendMessage(r,t),v},sendMessage:function(e,t){var r=void 0,n=!1;return t=t||{},t.method&&"function"==typeof t.method&&(t.method=l["default"].serializeFunction(t.method),n=!0),t.resolver||(t.resolver=i["default"].defer()),r={id:t.id,taskId:t.taskId,method:t.method,params:t.params,action:t.action,isEncodedMethod:n},r=l["default"].stringifyJson(r),e&&e.postMessage&&e.postMessage(r),t.resolver.promise}};t["default"]=v,e.exports=t["default"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),a=n(o),i={isPromise:function(e){return e&&"function"==typeof e.then},serializeFunction:function(e){return!(!e||"function"!=typeof e)&&encodeURI(e.toString())},deSerializeFunction:function(e){return!(!e||"string"!=typeof e)&&decodeURI(e)},serializeError:function(e){var t=void 0,r={},n=["name","message","stack","custom"];if(e instanceof Error){for(t=n.length-1;t>=0;t--)r[n[t]]=e[n[t]];return r}return r},deSerializeError:function(e){var t=void 0,r=new Error("");if(!e)return r;var n=Object.keys(e);for(t=0;t<n.length;t++)r[n[t]]=e[n[t]];return r},stringifyJson:function(e,t){t=t||a["default"].INVALID_JSON;try{e=JSON.stringify(e)}catch(r){console.warn(t)}return e},parseJson:function(e,t){var r=void 0;t=t||a["default"].PARSE_JSON;try{r=JSON.parse(e)}catch(n){console.warn(t)}return r}};t["default"]=i,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={INVALID_JSON:"Invalid JSON Object!",PARSE_JSON:"Can not parse stringifed data",NO_ID_PROVIDED:"Valid worker id should be provided",INVALID_DATA:"Some wrong message is being sent by Parent.",WORKER_ALREADY_TERMINATED:"Web Worker has already been terminated.",CONFIG_REQUIRED:"Configuration options required. Please read docs.",WORKER_NOT_SUPPORTED:"Web Worker not supported on this browser version",URL_REQUIRED:"Url is needed for creating and opening a new window/tab. Please read docs."};t["default"]=r,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={IDLE:"idle",ACTIVE:"active",TERMINATED:"terminated"};t["default"]=r,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={READY:"ready",EXEC:"execute"};t["default"]=r,e.exports=t["default"]},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_generalUtils=__webpack_require__(9),_generalUtils2=_interopRequireDefault(_generalUtils),_WorkerActionEnum=__webpack_require__(12),_WorkerActionEnum2=_interopRequireDefault(_WorkerActionEnum),WorkerThread=function(){function WorkerThread(e){_classCallCheck(this,WorkerThread),e||(e={}),_extends(this,e),this.config=e,this.methods={},e.unlistenEvents||this.addListeners()}return _createClass(WorkerThread,[{key:"sendMessage",value:function(e,t){t?postMessage(e,t):postMessage(e)}},{key:"exposeMethods",value:function(e){if(!e||"[object Object]"!==Object.prototype.toString.call(e))throw new Error("ExposeMethods function expects object");for(var t in e){var r=e[t];e.hasOwnProperty(t)&&"function"==typeof r&&(this.methods[t]=r)}}},{key:"onMessage",value:function onMessage(ev){var _this=this,result=void 0,messageData=void 0;if(messageData=_generalUtils2["default"].parseJson(ev.data)||{},messageData&&messageData.action===_WorkerActionEnum2["default"].EXEC){if(messageData.method){var _params=messageData.params;try{var _fn=void 0,method=void 0;_fn=messageData.isEncodedMethod?_generalUtils2["default"].deSerializeFunction(messageData.method):this.methods[messageData.method],method=eval("("+_fn+")"),result=method.apply(method,_params),_generalUtils2["default"].isPromise(result)?result.then(function(e){_this.sendMessage({id:messageData.id,taskId:messageData.taskId,action:messageData.action,result:e,error:null},ev.origin)})["catch"](function(e){_this.sendMessage({id:messageData.id,taskId:messageData.taskId,action:messageData.action,result:null,error:_generalUtils2["default"].serializeError(e)},ev.origin)}):this.sendMessage({id:messageData.id,taskId:messageData.taskId,action:messageData.action,result:result,error:null},ev.origin)}catch(e){this.sendMessage({id:messageData.id,taskId:messageData.taskId,action:messageData.action,result:null,error:_generalUtils2["default"].serializeError(e)},ev.origin)}}}else this.sendMessage({id:messageData.id,taskId:messageData.taskId,action:messageData.action},ev.origin)}},{key:"addListeners",value:function(){removeEventListener("message",this.onMessage.bind(this)),addEventListener("message",this.onMessage.bind(this))}}]),WorkerThread}();exports["default"]=WorkerThread,module.exports=exports["default"]}])});
//# sourceMappingURL=super-workers.min.js.map